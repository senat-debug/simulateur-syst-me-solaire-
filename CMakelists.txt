cmake_minimum_required(VERSION 3.15)
project(SolarSystemSimulator3D VERSION 1.0)

# Standard C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Options de compilation
if(MSVC)
    add_compile_options(/W4 /WX-)
    add_compile_definitions(_CRT_SECURE_NO_WARNINGS)
else()
    add_compile_options(-Wall -Wextra -pedantic)
    # Optimisations pour release
    set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} -O3")
endif()

# Trouver SDL3
find_package(SDL3 REQUIRED CONFIG)

# Si SDL3 n'est pas trouvé, décommentez et ajustez le chemin :
# set(SDL3_DIR "/usr/local/lib/cmake/SDL3")
# find_package(SDL3 REQUIRED CONFIG)

# Liste COMPLÈTE des fichiers source

set(SOURCES
    src/main.cpp
    src/Application.cpp
    src/vector3D.cpp   
    src/matrix4x4.cpp   
    src/Camera.cpp
    src/Mesh.cpp
    src/sphere.cpp
    src/rasterizer.cpp  
    src/Renderer3D.cpp
    src/CelestialBody.cpp
    src/SolarSystem.cpp
)

# Liste des headers (pour les IDEs)
set(HEADERS
    include/Application.h
    include/vector3D.h
    include/matrix4x4.h
    include/Camera.h
    include/Mesh.h
    include/sphere.h
    include/Rasterizer.h
    include/Renderer3D.h
    include/CelestialBody.h
    include/SolarSystem.h
    include/Constants.h
)

# Créer l'exécutable
add_executable(${PROJECT_NAME} ${SOURCES} ${HEADERS})

# Inclure les dossiers de headers
target_include_directories(${PROJECT_NAME} PRIVATE
    ${CMAKE_SOURCE_DIR}/include
)

# Lier SDL3
target_link_libraries(${PROJECT_NAME} PRIVATE SDL3::SDL3)

# Copier SDL3 DLL sur Windows
if(WIN32)
    add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different
        $<TARGET_FILE:SDL3::SDL3>
        $<TARGET_FILE_DIR:${PROJECT_NAME}>
    )
endif()

# Informations de build
message(STATUS "===========================================")
message(STATUS "  Solar System Simulator 3D v${PROJECT_VERSION}")
message(STATUS "===========================================")
message(STATUS "Compilateur: ${CMAKE_CXX_COMPILER_ID} ${CMAKE_CXX_COMPILER_VERSION}")
message(STATUS "Standard C++: ${CMAKE_CXX_STANDARD}")
message(STATUS "Build type: ${CMAKE_BUILD_TYPE}")
message(STATUS "SDL3 trouvé: ${SDL3_FOUND}")
message(STATUS "===========================================")

# Installation (optionnel)
install(TARGETS ${PROJECT_NAME}
    RUNTIME DESTINATION bin
)

# Tests (optionnel)
option(BUILD_TESTS "Build tests" OFF)
if(BUILD_TESTS)
    enable_testing()
    # Ajouter des tests ici
endif()

# Documentation avec Doxygen (optionnel)
option(BUILD_DOCS "Build documentation" OFF)
if(BUILD_DOCS)
    find_package(Doxygen)
    if(DOXYGEN_FOUND)
        # Configuration Doxygen
    endif()
endif()